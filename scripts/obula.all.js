function store_parameters(e,t,a,o){null==e&&(e=getProgrammeParameter()),null==t&&(t=getStudyStageParameter()),null==a&&(a=getStudentNumberParameter()),null==o&&(o=getStudentNameParameter());o=new Array(e,t,a,o);$("#obula_parameters").val(JSON.stringify(o))}function getProgrammeParameter(){var e="",t=$("#obula_parameters").val();return e=null!=t&&""!=t?JSON.parse(t)[0]:e}function getStudyStageParameter(){var e="",t=$("#obula_parameters").val();return e=null!=t&&""!=t?JSON.parse(t)[1]:e}function getStudentNumberParameter(){var e="",t=$("#obula_parameters").val();return e=null!=t&&""!=t?JSON.parse(t)[2]:e}function getStudentNameParameter(){var e="",t=$("#obula_parameters").val();return e=null!=t&&""!=t?JSON.parse(t)[3]:e}function loadStudentGraph(e,t,a=null,o=!1){var l="";null!=(l=null==a?$("#obula_currentweek").val():a)&&null!=l||(l="");a=$("#obula_banding_calc").val(),a={programme:getProgrammeParameter(),studentNumber:getStudentNumberParameter(),studentName:getStudentNameParameter(),chartType:e,currentWeek:l,bandingCalc:a,sStage:getStudyStageParameter()};$.ajax({type:"POST",url:"../blocks/obu_learnanalytics/students_graph.php",data:a,success:function(e){"object"==typeof e?($("#obula_error_cell").html(e.consolehtml),$("#obula_error_row").show(),alert("loadStudentGraph returned error, see console")):e.startsWith("<br />")?($("#obula_error_cell").html(e),$("#obula_error_row").show(),alert("loadStudentGraph returned error, see #obula_error_cell")):($("#obula_error_row").hide(),$("#obula_studentGraph_img_"+t).attr("src",e),document.getElementById("obula_studentGraphs_div").style.display="block",o&&document.getElementById("obula_studentGraphs_div").scrollIntoView(!1))},error:function(e){alert("loadStudentGraph post failed:"+e)}})}function changeChartTypeRB(e,t){loadStudentGraph(e,t)}function showWeekControl(e=null){var t="none"==document.getElementById("obula_before_week_row").style.display;null==e&&!t||$.ajax({type:"POST",url:"../blocks/obu_learnanalytics/week_control.php",data:{date:e},success:function(e){$("#obula_week_control_cell").html(e),t&&(document.getElementById("obula_before_placeholders_row").style.display="table-row",document.getElementById("obula_before_week_row").style.display="table-row")},error:function(e){alert("showWeekControl post failed:"+e)}})}function showDateControls(e=null,t=!1,a=!0){var o=document.getElementById("obula_weekdate"),l=null==o||"none"==o.style.display;null==e&&!l||$.ajax({type:"POST",url:"../blocks/obu_learnanalytics/date_controls.php",data:{date:e,weekControl:!0,semesterControl:a}}).done(function(e){null!=e&&e.success&&($("#obula_week_control_cell").html(e.weekControl),l&&t&&(document.getElementById("obula_before_placeholders_row").style.display="table-row",document.getElementById("obula_before_week_row").style.display="table-row"),a&&!t&&""!=e.semesterControl&&$("#obula_semester_control_cell").html(e.semesterControl))}).fail(function(e,t,a){alert("showDateControls post failed:"+a)})}function showDataCurrency(){var e=document.getElementById("obula_footer");null!=e&&"Data Currency"==e.innerHTML?$.ajax({type:"POST",url:"../blocks/obu_learnanalytics/data_currency.php"}).done(function(e){null!=e&&e.success&&($("#obula_footer").html(e.footerhtml),$("#obula_footer").show())}).fail(function(e,t,a){alert("showDataCurrency post failed:"+a)}):$("#obula_footer").show()}function takeOverPage(e){if("Y"!=$("#obula_page_taken")){$("#obula_page_taken").val("Y");var t=$("#nav-drawer").attr("aria-hidden");$("#obula_navbar_ariahidden").val(t),"false"==t&&$("button[data-action='toggle-drawer']").click();t=checkColumn(e);if(null!=t){$("#main-inner").hide(),$("#main-inner").attr("aria-hidden","true");e=$("#main-inner").attr("class");$("#main-inner").attr("class",e+" obula-block-collapsed"),t.className+=" obula-block-fullwidth",$("#page-header").hide(),$("#page-header").attr("aria-hidden","true");e=$("#page-header").attr("class");$("#page-header").attr("class",e+" obula-block-collapsed");for(var a,o=document.getElementById("block-region-side-pre").firstChild;o;)o===this||o.nodeType!==Node.ELEMENT_NODE||null!=(a=o.getAttribute("data-block"))&&"obu_learnanalytics"!=a&&0<o.offsetWidth&&(o.className+=" obula-block-hidden"),o=o.nextElementSibling||o.nextSibling}}}function giveBackPage(e){$("#main-inner").show(),$("#main-inner").attr("aria-hidden","false");var t=$("#main-inner").attr("class");$("#main-inner").attr("class",t.replace(" obula-block-collapsed","")),t=(t=e.className).replace(" obula-block-fullwidth",""),e.className=t,$("#obula_page_taken").val("N"),$("#page-header").show(),$("#page-header").attr("aria-hidden","false"),t=(t=$("#page-header").attr("class")).replace("obula-block-collapsed",""),$("#page-header").attr("class",t);for(var a,o=document.getElementById("block-region-side-pre").firstChild;o;)o!==this&&o.nodeType===Node.ELEMENT_NODE&&(null==(a=o.getAttribute("data-block"))||"obu_learnanalytics"==a||0<=(a=o.className).indexOf("obula-block-hidden")&&(o.className=a.replace(" obula-block-hidden",""))),o=o.nextElementSibling||o.nextSibling;t=$("#nav-drawer").attr("aria-hidden");"false"==$("#obula_navbar_ariahidden").val()&&"true"==t&&$("button[data-action='toggle-drawer']").click()}function checkColumn(e){for(var t=!1,a=e;a.parentNode;){if("block-region-side-pre"==(a=a.parentNode).id){t=!0;break}if("region-main"==a.id)break}return t?a.parentNode:null}function copyErrorTextToClipboard(){var e=document.getElementById("error-msg"),t=document.getElementById("obula_error_cell"),e=e.innerText;""!=t.innerText&&(e+="\r\n\r\n"+t.innerText),navigator.clipboard?navigator.clipboard.writeText(e).then(function(){},function(e){alert("Copy to clipboard failed")}):((t=document.getElementById("obula_copy2clip")).value=e,t.select(),ok=document.execCommand("copy"),ok)}function gotoFeedback(e){window.open("https://docs.google.com/forms/d/e/1FAIpQLScR2K62QEwoJyQJfYCuEt5W58ajYqIEbpMWcmNxzSmOoEmVeA/viewform?gxids=7628")}function showHelp(e){$.ajax({type:"POST",url:"../blocks/obu_learnanalytics/get_helptext.php",data:{helpType:e},beforeSend:function(){$("#obula_error_row").hide()}}).done(function(e){null!=e&&e.success&&($("#obula_modal_popup_title").html(e.title),$(".modal-body").html(e.popupbodyhtml),$("#obula_modal_body").removeClass("popup-pgm-search"),$("#obula_modal_close").show(),$("#obula_modal_close").prop("disabled",!1),$("#obula_modal_ok").hide(),$("#obula_modal_ok").prop("disabled",!0),$("#obula_modal_cancel").hide(),$("#obula_modal_footer_text").text(""),$("#obula_modal_footer_text").removeAttr("title"),$("#obula_modal_popup").modal("show"))}).fail(function(e){alert("showHelp exception")})}function clearSSC(e=!1){$("#obula_ssc_sid").val(""),$("#obula_summary_row").hide(),$("#obula_dash_row").hide(),$("#obula_footer").hide(),e?($("#obula_ssc_heading_sml").show(),$("#obula_ssc_input_sml").show()):($("#obula_ssc_heading_med").show(),$("#obula_ssc_input_med").show())}function collapseSSC(){var e=checkColumn(document.getElementById("obula_ssc_heading_sml"));clearSSC(e),e&&giveBackPage(e);$.ajax({type:"POST",url:"../blocks/obu_learnanalytics/close_dashboard.php",data:{dashboard:"Tutor"}}).done(function(e){}).fail(function(e,t,a){alert("close_dashboard post failed:"+a)})}function showBecomeView(e,t){var t=document.getElementsByClassName(t)[0].value,a=event.target;$.ajax({type:"POST",url:"../blocks/obu_learnanalytics/"+("S"==e?"become_student":"become_students_tutor")+".php",data:{studentNumber:t},beforeSend:function(){$("#obula_error_row").hide()}}).done(function(e){e.success?(takeOverPage(a),$("#obula_ssc_heading_sml").hide(),$("#obula_ssc_heading_med").hide(),$("#obula_ssc_input_sml").hide(),$("#obula_ssc_input_med").hide(),$("#obula_summary_cell").html(e.summaryhtml),$("#obula_summary_row").show(),$("#obula_dash_div").html(e.dashboardhtml),$("#obula_dash_row").show()):($("#obula_error_cell").html(e.message),$("#obula_error_row").show(),$("#obula_footer").hide())}).fail(function(e,t,a){alert("showBecomeView exception\\n"+a)}),showDataCurrency()}function ideasClicked(e){$.ajax({type:"POST",url:"../blocks/obu_learnanalytics/student_ideas.php",data:{studentNumber:e},success:function(e){$("#obula_student_ideas_div").html(e).delay(1e3),document.getElementById("obula_cohort_afterstatus_row").style.display="table-row",document.getElementById("obula_student_ideas_row").style.display="table-row",document.getElementById("obula_student_ideas_div").scrollIntoView(!1)},error:function(e){alert("ideasClicked post failed:"+e)}})}function showCohortComparison(e="il"){var o=!1;"il"==e&&(o=!0,e="1wk",showWeekControl());var t=$("#obula_currentweek").val();null!=t&&null!=t||(t="");e={programme:getProgrammeParameter(),sStage:getStudyStageParameter(),studentNumber:getStudentNumberParameter(),currentWeek:t,duration:e};$.ajax({type:"POST",url:"../blocks/obu_learnanalytics/cohort_engagement.php",data:e,success:function(e,t,a){$("#obula_cohort_comparison_img").attr("src",e),o&&(document.getElementById("obula_cohort_comparison_row").style.display="table-row",document.getElementById("obula_cohort_comparison_img").scrollIntoView(!1))},error:function(e){alert(`showCohortReady Event post failed:${e}`)}})}function changeElibHistRB(e){showELibraryHistory(e)}function showELibraryHistory(e="1wk"){var t=$("#obula_currentweek").val();null!=t&&null!=t||(t=""),showWeekControl();e={programme:getProgrammeParameter(),studentNumber:getStudentNumberParameter(),studentName:getStudentNameParameter(),currentWeek:t,width:900,ids2Chart:"*",duration:e};$.ajax({type:"POST",url:"../blocks/obu_learnanalytics/cohort_elibrary_history.php",data:e,success:function(e,t,a){$("#obula_elibrary_history_img").attr("src",e),document.getElementById("obula_elibrary_history_row").style.display="table-row",document.getElementById("obula_elibrary_history_img").scrollIntoView(!0)},error:function(e){alert(`showELibraryHistory Event post failed:${e}`)}})}function showStudentGraphs(){showWeekControl(),loadStudentGraph("vleduration",1,null,!0),loadStudentGraph("ezduration",2,null,!1),showDataCurrency()}function clickChangeWeek(e){var t=0<e?JSON.parse($("#obula_nextweek").val()):JSON.parse($("#obula_prevweek").val());$("#obula_currentweek").val(JSON.stringify(t));var a=new Date(t.first_day_week.date),o=(a.toString(),a.getFullYear()),e=a.getMonth(),a=a.getDate(),o=(a<10?"0"+a:a)+"-"+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e]+"-"+o;$("#obula_weekdate").text(o),showWeekControl(JSON.stringify(t)),"table-row"==document.getElementById("obula_cohort_comparison_row").style.display&&showCohortComparison(),"table-row"==document.getElementById("obula_elibrary_history_row").style.display&&showELibraryHistory(),"block"==document.getElementById("obula_studentGraphs_div").style.display&&(loadStudentGraph("vleduration",1,null,!0),loadStudentGraph("ezduration",2,null,!1),loadStudentGraph("loansline",3,null,!1),loadStudentGraph("attduration",4,null,!1))}function collapseTutor(){var e=checkColumn(document.getElementById("obula_ts_heading_sml"));$("#obula_summary_row").hide(),$("#obula_dash_row").hide(),$("#obula_footer").hide(),e?($("#obula_ts_heading_sml").show(),$("#obula_ts_input_sml").show()):($("#obula_ts_heading_med").show(),$("#obula_ts_input_med").show()),e&&giveBackPage(e);$.ajax({type:"POST",url:"../blocks/obu_learnanalytics/close_dashboard.php",data:{dashboard:"Tutor"}}).done(function(e){}).fail(function(e,t,a){alert("close_dashboard post failed:"+a)})}function showTutorFull(){var t=event.target;$.ajax({type:"POST",url:"../blocks/obu_learnanalytics/become_tutor.php",beforeSend:function(){$("#obula_error_row").hide()}}).done(function(e){e.success?(takeOverPage(t),$("#obula_ts_heading_sml").hide(),$("#obula_ts_input_sml").hide(),$("#obula_ts_heading_med").hide(),$("#obula_ts_input_med").hide(),$("#obula_summary_cell").html(e.summaryhtml),$("#obula_summary_row").show(),$("#obula_dash_div").html(e.dashboardhtml),$("#obula_dash_row").show()):($("#obula_error_cell").html(e.message),$("#obula_error_row").show(),$("#obula_footer").hide())}).fail(function(e,t,a){alert("showBecomeView exception\\n"+a)}),showDataCurrency()}$(document).ready(function(){checkColumn(document.getElementById("obula_ssc_heading_sml"))?($("#obula_ssc_heading_sml").show(),$("#obula_ssc_input_sml").show()):($("#obula_ssc_heading_med").show(),$("#obula_ssc_input_med").show())}),$(document).ready(function(){var e,o=$("#obula_cohort_comparison_img");null!=o&&0<o.length&&(1<o.length?alert("Multiple cohort engagement placeholders"):(null!=(e=$("#obula_currentweek").val())&&null!=e||(e=""),e={programme:getProgrammeParameter(),sStage:getStudyStageParameter(),studentNumber:getStudentNumberParameter(),currentWeek:e},$.ajax({type:"POST",url:"../blocks/obu_learnanalytics/cohort_engagement.php",data:e,success:function(e,t,a){$(o).attr("src",e)},error:function(e,t,a){alert(`student ready Event post failed:${a}`)}}),loadStudentGraph("vleduration",1),loadStudentGraph("ezduration",2)))}),$(document).ready(function(){checkColumn(document.getElementById("obula_ts_heading_sml"))?($("#obula_ts_heading_sml").show(),$("#obula_ts_input_sml").show()):($("#obula_ts_heading_med").show(),$("#obula_ts_input_med").show())});var gridLoading=studentLoading=chartLoading=!1;function set_gridLoading(e){e?(gridLoading=!0,$("#obula_dash_div").addClass("wait-cursor")):(gridLoading=!1)||studentLoading||chartLoading||$("#obula_dash_div").removeClass("wait-cursor")}function set_studentLoading(e){e?(studentLoading=!0,$("#obula_dash_div").addClass("wait-cursor")):(studentLoading=!1,gridLoading||studentLoading||chartLoading||$("#obula_dash_div").removeClass("wait-cursor"))}function set_chartLoading(e){e?(chartLoading=!0,$("#obula_dash_div").addClass("wait-cursor")):(chartLoading=!1,gridLoading||studentLoading||chartLoading||$("#obula_dash_div").removeClass("wait-cursor"))}function tutor_grid_done(e,t,a,o,l=!1,r=!1,n=!1){$('[data-toggle="ztooltip"]').tooltip({trigger:"hover"}),$("#obula_tutor_grid_div").html(t.html).delay(100),store_parameters(a,o,null,null),1!=t.full_data_set||t.success?void 0!==t.study_stages&&""!=t.study_stages&&(sstages=t.study_stages.split("|"),sstages.pop(),$("#selStudyStage option").each(function(){"*"==$(this).val()&&1<sstages.length||sstages.includes($(this).val())?$(this).show():1==t.full_data_set&&$(this).hide(),1==sstages.length&&$("#selStudyStage").val(sstages[0])}),stypes=t.study_types.split("|"),stypes.pop(),$("#selStudyType option").each(function(){"*"==$(this).val()&&1<stypes.length||stypes.includes($(this).val())?$(this).show():1==t.full_data_set&&$(this).hide(),1==stypes.length&&$("#selStudyType").val(stypes[0])})):($("#selStudyStage").prop("disabled",!0),$("#selStudyType").prop("disabled",!0)),0<t.advisees_count&&$("#obula_advisor").show(),1<t.students_count?$("#obula_chart_show").show():$("#obula_chart_show").hide(),r&&""!=t.date&&showDateControls(t.date,!1,n),t.success?(e||checkRefreshStudentBits(t.date,n),l&&showChart()):unClickStudent(),set_gridLoading(!1)}function highlightStudentRow(e){0<$("#obula_tutor_grid_table").length&&($("tr.students").removeAttr("selected"),$("#sid_"+e).attr("selected","selected"))}function clickStudent(e,t,a,o,l=!0,r=null){set_studentLoading(!0),highlightStudentRow(a),store_parameters(e,t,a,o);for(var n=1;n<=2;n++)null!=document.getElementById("obula_studentGraph_img_"+n)&&loadStudentGraph($("input[name="+(["vle","ez","loans","att"][n-1]+"charttype")+"]:checked","#obula_studentGraphs_div").val(),n,r,l);o=!0;"none"!=document.getElementById("obula_tutorsGraph_img").style.display&&(showChart(!0),o=!1),"none"!=document.getElementById("obula_studentmarks_div").style.display&&(showStudentsMarks(a,!1),o=!1),o&&set_studentLoading(!1),$("#obula_studentModule_img").hide(),$("#obula_studentModule_row").hide()}function unClickStudent(){store_parameters(null,null,"",""),document.getElementById("obula_studentGraphs_div").style.display="none",hideCharts(!0)}function showStudentInfo(e,t,a){$.ajax({type:"POST",url:"../blocks/obu_learnanalytics/get_student_info.php",data:{studentNumber:e,sName:t,advisor:a},beforeSend:function(){$("#obula_error_row").hide()}}).done(function(e){null!=e&&e.success&&($("#obula_modal_popup_title").html(e.title),$(".modal-body").html(e.popupbodyhtml),$("#obula_modal_body").removeClass("popup-pgm-search"),$("#obula_modal_close").show(),$("#obula_modal_close").prop("disabled",!1),$("#obula_modal_ok").hide(),$("#obula_modal_ok").prop("disabled",!0),$("#obula_modal_cancel").hide(),$("#obula_modal_footer_text").text(""),$("#obula_modal_footer_text").removeAttr("title"),$("#obula_modal_popup").modal("show"))}).fail(function(e){alert("showStudentInfo exception "+e.responseText)})}function showModuleEng(){var e=$("#obula_currentweek").val(),t=getStudentNumberParameter(),a=getStudentNameParameter();$.ajax({type:"POST",url:"../blocks/obu_learnanalytics/student_module_eng.php",data:{currentWeek:e,studentNumber:t,studentName:a},success:function(e){$("#obula_studentModule_img").attr("src",e),$("#obula_studentModule_img").show(),$("#obula_studentModule_row").show(),document.getElementById("obula_studentModule_row").scrollIntoView(!0)},error:function(e){alert("showModuleEng Event post failed:"+e)}})}function showStudentsMarks(e,t){$.ajax({type:"POST",url:"../blocks/obu_learnanalytics/student_marks_grid.php",data:{studentNumber:e},success:function(e){"object"==typeof e?($("#obula_error_cell").html(e.consolehtml),$("#obula_error_row").show(),alert("showStudentsMarks returned error, see console")):($("#obula_studentmarks_div").html(e).delay(1e3),(e=document.getElementById("obula_studentmarks_div")).style.display="block",t&&e.scrollIntoView(!0)),set_studentLoading(!1)},error:function(e){set_studentLoading(!1),alert("clickStudentsMark Event post failed:"+e)}})}function clickStudentsMark(e,t,a){showStudentsMarks(e,!0),"none"!=document.getElementById("obula_studentGraphs_div").style.display?clickStudent(getProgrammeParameter(),a,e,t,!1):highlightStudentRow(e)}function clickChangeWeek(e){wcDateChanged(0<e?"nextweek":"prevweek",null)}function semesterChanged(){var e;gridLoading||null!=(e=document.getElementById("selSemester"))&&wcDateChanged(null,e.value)}function wcDateChanged(e,t){reloadGrid(null!=e?e:t)}function checkRefreshStudentBits(e,t){var a=getStudentNumberParameter(),o=document.getElementById("obula_ids2chart").value;null!=o&&""!=a&&0!=o.includes(a,0)?("none"!=document.getElementById("obula_studentGraphs_div").style.display&&clickStudent(getProgrammeParameter(),getStudyStageParameter(),getStudentNumberParameter(),getStudentNameParameter(),!1,e),null!=(a=document.getElementById("obula_marksveng_tbl"))&&"none"!=a.style.display&&(t?$("#obula_marksveng_tbl").hide():showMarksvEng("rl",e))):unClickStudent()}function showChart(t=!1){$(".students-hideable").addClass("students-hidden"),$(".students-hideable").removeClass("students-hideable");var e,a=document.getElementById("selProgramme").value,o=document.getElementById("selStudyStage").value,l=document.getElementById("selStudyType").value;""!=a&&(set_chartLoading(!0),document.getElementById("obula_ids2chart").value,e=$("#obula_currentweek").val(),e={programme:a,sStage:o,sType:l,studentNumber:getStudentNumberParameter(),studentName:getStudentNameParameter(),currentWeek:e,studentDashboard:!1},$("#obula_chart_show").hide(),$.ajax({type:"POST",url:"../blocks/obu_learnanalytics/cohort_engagement.php",data:e,success:function(e){$("#obula_chart_hide").show(),$("#obula_chart_expand").show(),$("#obula_tutorsGraph_img").attr("src",e),$("#obula_tutorsGraph_img").show(),set_chartLoading(!1),t&&set_studentLoading(!1)},error:function(e){alert("showChart Event post failed:"+e),$("#obula_chart_show").show(),set_chartLoading(!0),t&&set_studentLoading(!1)}}))}function expandChart(){$("#obula_tutor_grid_div").is(":visible")?($("#obula_tutor_grid_div").hide(),$("#obula_chart_expand").text("Collapse Chart")):($("#obula_tutor_grid_div").show(),$("#obula_chart_expand").text("Expand Chart"))}function hideCharts(e=!1){$("#obula_tutorsGraph_img").hide(),$("#obula_chart_show").show(),$("#obula_chart_expand").hide(),$("#obula_chart_hide").hide(),$("#obula_tutor_grid_div").show(),$(".students-hidden").addClass("students-hideable"),$(".students-hidden").removeClass("students-hidden"),e&&($("#obula_marksveng_tbl").hide(),$("#obula_studentmarks_div").hide())}function showMarksvEng(e="il",t=null){"rl"!=(e="il"==e?"1wk":e)||null!=(o=$("input[name=mveradbuttons]:checked","#obula_marksveng_rbs").val())&&(e=o);var a,o,l=getProgrammeParameter();getStudyStageParameter();""!=l&&(a=document.getElementById("obula_ids2chart").value,o=(o=null)==t?$("#obula_currentweek").val():t,$.ajax({type:"POST",url:"../blocks/obu_learnanalytics/cohort_marks_v_engagement.php",data:{programme:l,ids2Chart:a,currentWeek:o,duration:e},success:function(e){$("#obula_marksveng_img").attr("src",e),$("#obula_marksveng_tbl").show()},error:function(e){alert("showMarksvEng Event post failed:"+e)}}))}function programmeChanged(){var e;gridLoading||(e=getProgrammeParameter(),store_parameters(document.getElementById("selProgramme").value,"*","",""),unClickStudent(),$("#obula_myacc").prop("checked",!1),$("#obula_title").text("Learning Analytics"),$("#obula_title").removeClass("ssc-title"),$("#obula_title").addClass("tutor-title"),reloadGrid("programme",e))}function clickSearchProgrammeOld(){var e,t,a;gridLoading||(t=(e=document.getElementById("selProgramme")).value,null==e||null!=(a=prompt("Enter Programme Code",e.value))&&""!=a&&(e.value=a.toUpperCase(),""==e.value?(alert("Invalid Programme Code, try again"),e.value=t):programmeChanged()))}function clickSearchProgramme(){var e,t;gridLoading||(e=$("#selProgramme").val(),t=$("#selProgramme option:selected").text(),$.ajax({type:"POST",url:"../blocks/obu_learnanalytics/programme_search.php",data:{oldValue:e,oldName:t},beforeSend:function(){$("#obula_error_row").hide()}}).done(function(e){null!=e&&e.success&&($("#obula_modal_popup_title").html(e.title),$(".modal-body").html(e.popupbodyhtml),$("#obula_modal_body").addClass("popup-pgm-search"),$("#obula_modal_close").hide(),$("#obula_modal_close").prop("disabled",!0),$("#obula_modal_ok").prop("disabled",!0),$("#obula_modal_ok").show(),$("#obula_modal_ok").on("click",clickSearchPGMOK),$("#obula_modal_cancel").show(),$("#obula_modal_popup").on("shown.bs.modal",function(){$("#obula_search_str").focus()}),$("#obula_modal_popup").modal("show"))}).fail(function(e){alert("searchProgramme exception")}))}function clickSearchPGMOK(){var e=document.getElementById("selProgramme");e.value=$("#obula_modal_footer_text").attr("title"),""==e.value?(alert("Invalid Programme Code, try again"),e.value=oldValue):programmeChanged()}function showSearchProgrammeResults(e){var a,t=null;0<e.length&&0==(t=searchProgrammeCode(e)).length&&(e.length<3||"-"==e.slice(-1)||(t=searchProgrammes(e))),0==e.length||0==t.length?(unpickPGMCode(),document.getElementById("obula_results").innerHTML=e.length<3?"":"No Match"):(a='<ul class="popup-pgm-ul">',t.forEach(function(e,t){null==e?a+="<li>...</li>":(a+='<li title="'+e.code+'" onclick="pickPGMCode(\''+e.code+"', false)\"",a+=" ondblclick=\"pickPGMCode('"+e.code+"', true)\">",a+=e.name+"</li>")}),a+="</ul>",document.getElementById("obula_results").innerHTML=a,1==t.length&&pickPGMCode(t[0].code,!1))}function searchProgrammeCode(e){var t=e.toUpperCase(),a=document.getElementById("selProgramme"),o=new Array;for(i=0;i<a.options.length;i++)if(a.options[i].value.toUpperCase()==t){result={code:a.options[i].value.toUpperCase(),name:a.options[i].text},o.push(result);break}return o}function searchProgrammes(e){var t=e.toUpperCase(),a=document.getElementById("selProgramme"),o=new Array,l=0;for(i=0;i<a.options.length;i++)if(-1!=a.options[i].text.toUpperCase().indexOf(t)||-1!=a.options[i].value.toUpperCase().indexOf(t)){if(10==l){o.push(null);break}result={code:a.options[i].value.toUpperCase(),name:a.options[i].text},o.push(result),l++}return o}function pickPGMCode(e,t=!1){var a=searchProgrammeCode(e);$("#obula_modal_footer_text").text(a[0].name),$("#obula_modal_footer_text").attr("title",e),$("#obula_modal_ok").prop("disabled",!1),t&&(clickSearchPGMOK(),$("#obula_modal_popup").modal("hide"))}function unpickPGMCode(){$("#obula_modal_footer_text").text(""),$("#obula_modal_footer_text").removeAttr("title"),$("#obula_modal_ok").prop("disabled",!0)}function studyStageChanged(){gridLoading||(unClickStudent(),$("#obula_myacc").prop("checked",!1),reloadGrid())}function bandingChanged(){var e;gridLoading||null!=(e=document.getElementById("selBanding"))&&($("#obula_banding_calc").val(e.value),reloadGrid())}function studyTypeChanged(){gridLoading||null!=document.getElementById("selStudyType")&&(unClickStudent(),reloadGrid())}function myaccChanged(){gridLoading||(unClickStudent(),reloadGrid())}function maxShowChanged(){gridLoading||reloadGrid()}function clickCohortHeading(){gridLoading||clickHeading("cohort")}function clickStudentHeading(){gridLoading||clickHeading("student")}function clickHeading(e){var t,a,o;gridLoading||($(this).tooltip("hide"),unClickStudent(),a=t="?",a=$("#obula_"+e+"_sort").prop("name")=="obula_"+e+"_down"?(t="obula_"+e+"_up","up"):(t="obula_"+e+"_down","down"),$("#obula_"+e+"_sort").prop("name",t),"no"!=(e="obula_cohortfirst_0"==(o=$("#obula_swap_sort").prop("name"))&&"student"==e?"cohort":"obula_cohortfirst_1"==o&&"cohort"==e?"student":"no")&&(t="obula_"+e+"_"+a,$("#obula_"+e+"_sort").prop("name",t)),reloadGrid())}function clickSwapHeading(){var e;gridLoading||(unClickStudent(),e="?",e="obula_cohortfirst_1"==$("#obula_swap_sort").prop("name")?"obula_cohortfirst_0":"obula_cohortfirst_1",$("#obula_swap_sort").prop("name",e),reloadGrid())}function reloadGrid(e=null,t=null){var a,o,l,r,n,u,d,s,i,c,_,m,h;gridLoading||(set_gridLoading(!0),a=null==(i=document.getElementById("selMaxShow"))?10:i.value,o=document.getElementById("selProgramme").value,c=document.getElementById("selStudyStage"),l=null==c?"*":c.value,r=null==(_=document.getElementById("selStudyType"))?"*":_.value,m=document.getElementById("obula_myacc"),null!=e&&"programme"==e&&(c.value=l="*",_.value=r="*",null!=m&&(m.checked=!1),a=10),n="none"!=document.getElementById("obula_tutorsGraph_img").style.display,u="obula_cohort_down"==$("#obula_cohort_sort").prop("name")?"down":"up",d="obula_student_down"==$("#obula_student_sort").prop("name")?"down":"up",s="obula_cohortfirst_1"==$("#obula_swap_sort").prop("name")?1:0,i=$("#obula_banding_calc").val(),c=$("#obula_currentweek").val(),_=!1,null!=m&&m.checked&&(_=!0),h=!(m=null),null!=e&&"programme"!=e&&"nextweek"!=e&&"prevweek"!=e&&(m=e,h=!(e="semester")),$.ajax({type:"POST",url:"../blocks/obu_learnanalytics/tutor_grid.php",data:{programme:o,sStage:l,maxShow:a,sStageSort:u,studentSort:d,cohortfirst:s,currentWeek:c,bandingCalc:i,studyType:r,onlyMyAdvisees:_,semester:m,option:e,oldProgramme:t}}).done(function(e){tutor_grid_done(!1,e,o,l,n,!0,h)}).fail(function(e,t,a){alert("reloadGrid 2 post failed:"+a)}))}$(document).ready(function(){set_gridLoading(!0);var t=document.getElementById("selProgramme").value,a="*",e=document.getElementById("selStudyStage");null!=e&&(a=e.value);e=document.getElementById("selStudyType"),e=null==e?"*":e.value;showDateControls("getcurrent",!1,!0),$.ajax({type:"POST",url:"../blocks/obu_learnanalytics/tutor_grid.php",data:{programme:t,sStage:a,maxShow:10,sStageSort:"down",studentSort:"down",cohortfirst:1,currentWeek:"",bandingCalc:"MED-20-4",studyType:e,onlyMyAdvisees:!1,semester:"",option:"getcurrent"}}).done(function(e){tutor_grid_done(!0,e,t,a)}).fail(function(e){alert("reloadGrid 1 post failed:"+e)})});